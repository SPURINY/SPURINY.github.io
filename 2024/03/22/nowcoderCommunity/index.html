<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>nowcoderCommunity | Purin&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="·&#x2F;  日程记录：2024年3月24日 springmvc入门 2024年3月25日 mybatis入门（我的test代码总报错也没搜到解决方案，就先拿视频源码直接用了 3.26 首页（没加分页 3.27早上 解决了昨天的错误 3.28 首页（加了分页） 3.30 学了发邮件 3.31 注册+邮件激活，验证码 4.2 登录＋点登陆后爆bug没解决 清明旅游＋回来水了3天 4.10 显示">
<meta property="og:type" content="article">
<meta property="og:title" content="nowcoderCommunity">
<meta property="og:url" content="https://spuriny.github.io/2024/03/22/nowcoderCommunity/index.html">
<meta property="og:site_name" content="Purin&#39;s blog">
<meta property="og:description" content="·&#x2F;  日程记录：2024年3月24日 springmvc入门 2024年3月25日 mybatis入门（我的test代码总报错也没搜到解决方案，就先拿视频源码直接用了 3.26 首页（没加分页 3.27早上 解决了昨天的错误 3.28 首页（加了分页） 3.30 学了发邮件 3.31 注册+邮件激活，验证码 4.2 登录＋点登陆后爆bug没解决 清明旅游＋回来水了3天 4.10 显示">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240327080253061.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240324091848926.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240325085432166.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240325085559606.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240325094222286.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240328110823273.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240328121423745.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240329231951610.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240330215434052.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331163352887.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331171622206.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331174810188.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331180927822.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331185134231.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331195713102.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240331195740507.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240402180450811.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240402181441760.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240407175637429.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240410141445854.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240410155713880.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240410213641775.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240412163832321.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240412164629627.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240412164942577.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240417170518834.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418112225866.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418112434148.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418112840199.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418113109221.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418113233878.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418113442838.png">
<meta property="og:image" content="https://spuriny.github.io/2024/03/22/images/image-20240418114400647.png">
<meta property="article:published_time" content="2024-03-22T11:34:09.000Z">
<meta property="article:modified_time" content="2024-04-19T04:32:22.625Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://spuriny.github.io/2024/03/22/images/image-20240327080253061.png">
  
    <link rel="alternate" href="/atom.xml" title="Purin's blog" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/images/FPbhxHyaUAIkHwN.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Purin's blog </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/categories">Categories</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/categories">Categories</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/images/113333105_p0_master1200.jpg></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">purin </div>
      <div class="dot"></div>
      <div class="subtitle">習慣は第二の天性なり </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com/purins15" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://peing.net/zh-CN/puriny" title="peing"><i class="fa-solid fa-pencil"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/SPURINY" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box"></div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Tags</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/doc/" rel="tag">doc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ssm/" rel="tag">ssm</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ssm-mybatis/" rel="tag">ssm mybatis</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/test-tag2/" rel="tag">test tag2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%91%A8%E6%8A%A5/" rel="tag">周报</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%AC%94%E8%AF%95/" rel="tag">笔试</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Archives</h3>
      
      
        <a class="archive-link" href="/archives/2024/04 ">
          April 2024 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2024/03 ">
          March 2024 
          <div class="archive-count">12 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/12 ">
          December 2023 
          <div class="archive-count">3 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/11 ">
          November 2023 
          <div class="archive-count">5 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/2024/04/19/linux/" title="linux" >
            <div class="recent-link-text">
              linux
            </div>
          </a>
        
          <a class="recent-link" href="/2024/04/01/%E5%8F%8C%E6%8C%87%E9%92%88/" title="双指针" >
            <div class="recent-link-text">
              双指针
            </div>
          </a>
        
          <a class="recent-link" href="/2024/03/31/%E5%91%A8%E6%8A%A5/" title="周报" >
            <div class="recent-link-text">
              周报
            </div>
          </a>
        
          <a class="recent-link" href="/2024/03/30/%E7%AC%94%E8%AF%95%E9%A2%98%E3%80%90%E5%88%B7%E9%A2%98%E8%8A%82%E3%80%9158%E9%9B%86%E5%9B%A223%E6%A0%A1%E6%8B%9B%E5%90%8E%E7%AB%AF-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%8D%B7/" title="笔试题【刷题节】58集团23校招后端/移动端工程师卷" >
            <div class="recent-link-text">
              笔试题【刷题节】58集团23校招后端/移动端工程师卷
            </div>
          </a>
        
          <a class="recent-link" href="/2024/03/25/py-note/" title="py note" >
            <div class="recent-link-text">
              py note
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-nowcoderCommunity" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        nowcoderCommunity
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-03-22T11:34:09.000Z" itemprop="datePublished">2024-03-22</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
    Uncategorized 
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            39k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <hr>
<p>·&#x2F;</p>
<hr>
<h1 id="日程记录："><a href="#日程记录：" class="headerlink" title="日程记录："></a>日程记录：</h1><p>2024年3月24日 springmvc入门</p>
<p>2024年3月25日 mybatis入门（我的test代码总报错也没搜到解决方案，就先拿视频源码直接用了</p>
<p>3.26 首页（没加分页</p>
<p>3.27早上 解决了昨天的错误</p>
<p>3.28 首页（加了分页）</p>
<p>3.30 学了发邮件</p>
<p>3.31 注册+邮件激活，验证码</p>
<p>4.2 登录＋点登陆后爆bug没解决</p>
<p>清明旅游＋回来水了3天</p>
<p>4.10 显示登陆信息(拦截器)+修改头像+修改密码(视频没有自己写的，可能后期会有bug)</p>
<hr>
<h1 id="报错记录"><a href="#报错记录" class="headerlink" title="报错记录"></a>报错记录</h1><p>1.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/aojun/p/14359464.html">https://www.cnblogs.com/aojun/p/14359464.html</a></p>
<ul>
<li>从中学到该看“<code>caused by</code>”</li>
</ul>
<img src="../images/image-20240327080253061.png" alt="image-20240327080253061" style="zoom:50%;" />

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44447330/article/details/122291201">https://blog.csdn.net/weixin_44447330/article/details/122291201</a></p>
<ul>
<li><p>null导致的可能性</p>
<ul>
<li><p>发现我确实没写list判断是否为空的语句，就直接去遍历list，修改后：</p>
</li>
<li><pre><code class="java">if (list != null) &#123;//
    for (DiscussPost i : list) &#123;
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;post&quot;, i);//把帖子数据放入map
        User user = userService.getUser(i.getId());//获取id对应的用户实体对象
        System.out.println(user.toString());//
        map.put(&quot;user&quot;, user);//把用户数据放入map
        posts.add(map);//把map放入posts列表
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 顺便加了个`System.out.println(user.toString());`看看有没有user为空的可能性</span><br><span class="line"></span><br><span class="line">- 然后变成：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
Wed Mar 27 08:11:19 CST 2024
There was an unexpected error (type=Internal Server Error, status=500).
Cannot invoke &quot;com.nowcoder.community.entity.User.toString()&quot; because &quot;user&quot; is null
java.lang.NullPointerException: Cannot invoke &quot;com.nowcoder.community.entity.User.toString()&quot; because &quot;user&quot; is null
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  看来确实是user为空</span><br><span class="line"></span><br><span class="line">  - 后来打印`i.getId()`输出200+，翻看数据表发现和userid对不起来，倒是像帖子id，然后定睛一看：&lt;u&gt;获取用户id要用`getUserId()`&lt;/u&gt;，，嗯嗯很无语，说明帖子id用pid命名的重要性，，，</span><br><span class="line"></span><br><span class="line">然后就成功加载主页了&lt;img src=&quot;../images/image-20240327085834737.png&quot; alt=&quot;image-20240327085834737&quot; style=&quot;zoom: 33%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">2.@Mapper正常，但换成@Reposity无法启动</span><br><span class="line"></span><br><span class="line">[@mapper换成@repository后无法注入-CSDN社区](https://bbs.csdn.net/topics/392444913)</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line"></span><br><span class="line"># springmvc入门</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;../images/image-20240324073558950.png&quot; alt=&quot;image-20240324073558950&quot; style=&quot;zoom:50%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">- springmvc中所有组件由**DispatcherServlet调用**</span><br><span class="line">- 三层架构≠mvc</span><br><span class="line">  - 请求到达表现层，表现层调用业务层，层层往下；表现层接收到查询的数据，controller封装成model，DiapatcherServlet交给view渲染页面</span><br><span class="line"></span><br><span class="line">![image-20240324074404444](../images/image-20240324074404444.png)</span><br><span class="line"></span><br><span class="line">- 前端控制器(DispatcherServlet) 调用流程：</span><br><span class="line">- ![image-20240324074510836](../images/image-20240324074510836.png)</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">模板引擎--生成动态html</span><br><span class="line"></span><br><span class="line">[Thymeleaf](https://www.thymeleaf.org/)</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;../images/image-20240324074918034.png&quot; alt=&quot;image-20240324074918034&quot; style=&quot;zoom:33%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">在application.properties里：</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line">#开发时关闭thymelaefa缓存，避免页面没及时刷新；项目上线后开启，降低服务器负担</span><br><span class="line">spring.thymeleaf.cache=false</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>ctrl+n搜索ThymeleafAutoConfiguration：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;ThymeleafProperties.class&#125;)</span><span class="comment">//详细参数的配置</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafAutoConfiguration</span> &#123;</span><br></pre></td></tr></table></figure>

<p>进入ThymeleafProperties.class：</p>
<pre><code>- 在配置里写`spring.thymeleaf.cache`相当于给`ThymeleafProperties`类的cache属性赋值
- server同理，搜`ServerProperties`查看即可
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.thymeleaf&quot;//前缀</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> &#123;</span><br><span class="line">    。。。</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> cache;</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>@ResponseBody的作用其实是将java对象转为json格式的数据。写入到response对象的body区，通常用来返回JSON数据或者是XML数据。</li>
<li>使用此注解之后不会再走视图处理器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 此方法利用servlet在页面输出，所以没加@ResponseBody</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;http&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">http</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line">        System.out.println(request.getServletPath());</span><br><span class="line">        System.out.println(request.getMethod());</span><br><span class="line">        Enumeration&lt;String&gt; headerNames = request.getHeaderNames();</span><br><span class="line">        <span class="keyword">while</span>(headerNames.hasMoreElements())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> headerNames.nextElement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">header</span> <span class="operator">=</span> request.getHeader(name);</span><br><span class="line">            System.out.println(name+<span class="string">&quot;:&quot;</span>+header);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(request.getParameter(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">            writer.write(<span class="string">&quot;&lt;h1&gt;nowcode&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>请求方式post</p>
<img src="../images/image-20240324091848926.png" alt="image-20240324091848926" style="zoom:33%;" />

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/hello/student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* post方式，访问/html/post.html并提交表单后交由student()处理</span></span><br><span class="line"><span class="comment">* 放在static目录下，但是访问路径不用加/static</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;student&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">student</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>响应html</p>
<ul>
<li>在templates目录下创建模板文件</li>
</ul>
<img src="../images/image-20240325085432166.png" alt="image-20240325085432166" style="zoom:33%;" />

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--声明这个html是thymeleaf模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--从model中取对应属性，放到段落中--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>写controller中对应的handler</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    响应html</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(path=&quot;teacher&quot;,method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">getTeacher</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();<span class="comment">//model</span></span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lily&quot;</span>);</span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;age&quot;</span>,<span class="number">29</span>);</span><br><span class="line">    <span class="comment">//model和view的数据都装到了一个对象里</span></span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;/demo/view&quot;</span>);</span><br><span class="line">    <span class="comment">//视图的路径，模板文件的路径，即/templates/demo/view.html</span></span><br><span class="line">    <span class="keyword">return</span> modelAndView;<span class="comment">//返回model</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>访问实例：</li>
</ul>
<img src="../images/image-20240325085559606.png" alt="image-20240325085559606" style="zoom:50%;" />

<p>易知返回的是html页面，模板把${name}替换成了具体内容</p>
<hr>
<p>响应html方式2</p>
<ul>
<li><p>模板文件同上</p>
</li>
<li><pre><code class="java">/*响应html2*/
    @RequestMapping(path=&quot;school&quot;,method = RequestMethod.GET)
    public String getSchool(Model model)&#123;//DispatcherServlet帮忙创建的model
        //返回类型String是因为 返回视图文件的路径
        model.addAttribute(&quot;name&quot;,&quot;tokyodaigaku&quot;);
        return &quot;/demo/view&quot;;
    &#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ---------</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line"></span><br><span class="line">返回Json数据【常用于异步请求】</span><br><span class="line"></span><br><span class="line">&gt; 异步请求：页面不刷新，但是悄悄访问了服务器（如：注册时填写完nickname，没刷新页面却显示了xx昵称已被使用--&gt;访问了数据库--&gt;一般结果不会是html页面，只是判断的结果）</span><br><span class="line"></span><br><span class="line">&gt; java对象-&gt;JSON字符串-&gt;JS对象【json起衔接转化作用】</span><br><span class="line"></span><br><span class="line">- 返回JSON数据，handler必须加`@ResponseBody`否则会以为是html页面</span><br><span class="line"></span><br><span class="line">- handler</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">/*响应JSON数据*/</span><br><span class="line">    @RequestMapping(&quot;json&quot;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public Map&lt;String,Object&gt; getjson()&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;name&quot;,&quot;purin&quot;);</span><br><span class="line">        map.put(&quot;age&quot;,&quot;close to 21&quot;);</span><br><span class="line">        map.put(&quot;language&quot;,&quot;cn-en-jp&quot;);</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>结果：</p>
</li>
</ul>
<p>响应类型：<code>Content-Type:application/json</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;purin&quot;,&quot;language&quot;:&quot;cn-en-jp&quot;,&quot;age&quot;:&quot;close to 21&quot;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="mybatis入门"><a href="#mybatis入门" class="headerlink" title="mybatis入门"></a>mybatis入门</h1><img src="../images/image-20240325094222286.png" alt="image-20240325094222286" style="zoom:50%;" />

<ul>
<li>在springboot中前三个核心组件被集成了，不需要人为来写</li>
</ul>
<hr>
<ul>
<li>application.properties里写数据源和数据库连接配置</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataSourceProperties</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/community?characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Hongkong</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">666</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.maximum-pool-size</span>=<span class="string">15</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.minimum-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.idle-timeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># MybatisProperties</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.nowcoder.community.entity</span></span><br><span class="line"><span class="attr">mybatis.configuration.useGeneratedKeys</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">mybatis.configuration.mapUnderscoreToCamelCase</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>其他步骤和之前mybatis一样</li>
</ul>
<hr>
<ul>
<li><p>复用sql：</p>
<ul>
<li><p>提取出常用的字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id=&quot;insertFields&quot;&gt;</span><br><span class="line">        username, password, salt, email, type, status, activation_code, header_url, create_time</span><br><span class="line">    &lt;/sql&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用：&lt; include&gt;&lt; &#x2F;include&gt;</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into user (&lt;include refid=&quot;insertFields&quot;&gt;&lt;/include&gt;)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># logger</span></span><br><span class="line"><span class="attr">logging.level.com.nowcoder.community</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure>

<ul>
<li>把这个包的级别调为debug，这样控制台还会显示sql预编译的样子</li>
</ul>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=101, username=&#x27;liubei&#x27;, password=&#x27;390ba5f6b5f18dd4c63d7cda170a0c74&#x27;, salt=&#x27;12345&#x27;, email=&#x27;nowcoder101@sina.com&#x27;, type=0, status=1, activationCode=&#x27;null&#x27;, headerUrl=&#x27;http://images.nowcoder.com/head/100t.png&#x27;, createTime=Wed Apr 03 12:04:55 CST 2019&#125;</span><br><span class="line">==&gt;  Preparing: select id, username, password, salt, email, type, status, activation_code, header_url, create_time from user where email = ? </span><br><span class="line">==&gt; Parameters: nowcoder101@sina.com(String)</span><br><span class="line">&lt;==      Total: 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<hr>
<h1 id="开发首页"><a href="#开发首页" class="headerlink" title="开发首页"></a>开发首页</h1><ul>
<li>先做不考虑分页的版本</li>
<li>再加上分页</li>
</ul>
<p>controller:</p>
<p>写方法的时候要想到以后加分页的可能性来去设计</p>
<p>由于Post对象只有userid，而username具体在User对象里，所以一起放到map里了</p>
<p>DispatcherServlet自动生成参数里的model对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/index&quot;, method = RequestMethod.GET)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getIndexPage</span><span class="params">(Model model)</span>&#123;<span class="comment">//使用模板</span></span><br><span class="line">         <span class="comment">//这个查出来的post数据只有userid，没有username，所以后面用userService查出user，一起放map里了</span></span><br><span class="line">       List&lt;DiscussPost&gt; list = discussPostService.selectDiscussPosts(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">       List&lt;Map&lt;String,Object&gt;&gt; posts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (list != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">for</span> (DiscussPost i : list) &#123;</span><br><span class="line">               Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">               <span class="comment">//System.out.println(i.toString());</span></span><br><span class="line">               map.put(<span class="string">&quot;post&quot;</span>, i);<span class="comment">//把帖子数据放入map</span></span><br><span class="line">               <span class="comment">//System.out.println(i.getId());</span></span><br><span class="line">               <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUser(i.getUserId());<span class="comment">//获取id对应的用户实体对象</span></span><br><span class="line">               System.out.println(user.toString());</span><br><span class="line">               map.put(<span class="string">&quot;user&quot;</span>, user);<span class="comment">//把用户数据放入map</span></span><br><span class="line"></span><br><span class="line">               posts.add(map);<span class="comment">//把map放入posts列表</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       model.addAttribute(<span class="string">&quot;posts&quot;</span>,posts);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;<span class="comment">//模板文件路径</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>帖子列表部分</p>
<ul>
<li>需要动态拼接的加<code>th:</code>表示用thymeleaf语法</li>
<li>${map.user.headerUrl}看着像访问属性，其实<code>底层是调用了getXXX()</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 帖子列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-unstyled&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;media pb-3 pt-3 mb-3 border-bottom&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;map:$&#123;posts&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--$&#123;posts&#125;是model.addAtri的-;&quot;map:&quot;表示每次循环得到一个map--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;site/profile.html&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--利用模板语法，写动态的内容--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--map.user.headerUrl写着是xx.xx.xx其实底层调用getXXX()--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;map.user.headerUrl&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mr-4 rounded-circle&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;用户头像&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:50px;height:50px;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;media-body&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h6</span> <span class="attr">class</span>=<span class="string">&quot;mt-0 mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;map.post.title&#125;&quot;</span>&gt;</span>备战春招，面试刷题跟他复习，一个月全搞定！<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary bg-primary&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;map.post.type==1&#125;&quot;</span>&gt;</span>置顶<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="comment">&lt;!--加判断--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary bg-danger&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;map.post.status==1&#125;&quot;</span>&gt;</span>精华<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font-size-12&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">u</span> <span class="attr">class</span>=<span class="string">&quot;mr-3&quot;</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;map.user.username&#125;&quot;</span>&gt;</span>寒江雪<span class="tag">&lt;/<span class="name">u</span>&gt;</span> 发布于 <span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(map.post.createTime,&#x27;yyyy-MM-dd HH:mm:ss&#x27;)&#125;&quot;</span>&gt;</span>2019-04-15 15:32:18<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;d-inline float-right&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;d-inline ml-2&quot;</span>&gt;</span>赞 11<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;d-inline ml-2&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;d-inline ml-2&quot;</span>&gt;</span>回帖 7<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>						</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>分页部分：</p>
<ul>
<li><p><code>dispatcherServlet</code>会自动识别page 把page加到model里，所以可以在${page.xxx}直接用<img src="../images/image-20240328110823273.png" alt="image-20240328110823273" style="zoom:33%;" /></p>
</li>
<li><p>Page实体类储存分页信息</p>
<ul>
<li>current,limit从页面获取  totalRows,path传给页面</li>
<li>setter加处理，防止传入奇怪不合理的数</li>
<li>加方法 ：获得当前页起始行 总页数 起始页 结束页</li>
</ul>
</li>
<li><p>修改controller加入分页后的动态部分</p>
<ul>
<li><pre><code class="java">public String getIndexPage(Model model, Page page)&#123;//使用模板
        page.setPath(&quot;/index&quot;);//复用路径
        page.setTotalRows(discussPostService.selectDiscussPostRows(0));//总条数
        List&lt;DiscussPost&gt; list = discussPostService.selectDiscussPosts(0, page.getOffset(), page.getLimit());//根据当前页其实行数和每页条数，查询出当前页的帖子（之前没加分页时是默认第一页
       
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```html</span><br><span class="line">  th:href=&quot;@&#123;$&#123;page.path&#125;(current=1)&#125;&lt;!--即&quot;index?current=1&quot;--&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><pre><code class="html">&lt;li th:class=&quot;|page-item $&#123;page.current==1?&#39;disabled&#39;:&#39;&#39;&#125;|&quot;&gt;上一页&lt;/li&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - `||`表示里面有静态的和动态拼接的，上句为：如果当前第一页就disabled,即第一页不能点上一页</span><br><span class="line"></span><br><span class="line">--------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">遇到的问题：不知道为什么，分页部分我的代码的响应体的html从&lt; li&gt;下一页&lt; /li&gt;的下一行开始全是空白，没找到原油就先把源码站过来了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调试</span><br><span class="line"></span><br><span class="line">服务器打断点--调试状态下：</span><br><span class="line"></span><br><span class="line">- F8 向下一行</span><br><span class="line"></span><br><span class="line">- F7 进入方法内部 再按F8 回去了</span><br><span class="line">- F9 直接到下一个断点处（比如想跳过某循环），如果下面没有断点了就直接结束了</span><br><span class="line"></span><br><span class="line"># 版本控制</span><br><span class="line"></span><br><span class="line">- 本地和远程都有仓库，先提交到本地仓库，再推送给远程仓库</span><br><span class="line">- 本地仓库操作：</span><br><span class="line"></span><br><span class="line">```git</span><br><span class="line">cd d:  切换到d盘</span><br><span class="line">cd 具体目录</span><br><span class="line">git init</span><br><span class="line">git status</span><br><span class="line">git add *  所有的都添加到本地仓库（受管理）【但只是临时存，还需要提交</span><br><span class="line">Git commit -m&#x27;备注&#x27;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>git采用ssl，所以要配密钥（已经弄过了</p>
</li>
<li><p>远程仓库操作：</p>
<ul>
<li>先在github上建同名仓库</li>
<li><code>git remote add origin 仓库地址</code>,把本地仓库和远程仓库关联起来，并给远程仓库起别名为origin</li>
<li><code>git push -u 远程仓库别名 分支名</code><a target="_blank" rel="noopener" href="https://blog.csdn.net/gongdamrgao/article/details/115032436">关于git的问题：error: src refspec main does not match any-CSDN博客</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="社区登录模块"><a href="#社区登录模块" class="headerlink" title="社区登录模块"></a>社区登录模块</h1><h2 id="发邮件"><a href="#发邮件" class="headerlink" title="发邮件"></a>发邮件</h2><img src="../images/image-20240328121423745.png" alt="image-20240328121423745" style="zoom: 33%;" />



<h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><p>1.<code>smtps</code>后有一个空格</p>
<img src="../images/image-20240329231951610.png" alt="image-20240329231951610" style="zoom:33%;" />



<ol start="2">
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.mail.MailAuthenticationException: Authentication failed; nested exception is javax.mail.AuthenticationFailedException: 535 5.7.8 authentication failed</span><br></pre></td></tr></table></figure>

<p>properties里发件人密码改成<strong>授权码</strong></p>
<hr>
<p>配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mail</span></span><br><span class="line"><span class="attr">spring.mail.host</span>=<span class="string">smtp.sina.com</span></span><br><span class="line"><span class="attr">spring.mail.port</span>=<span class="string">465</span></span><br><span class="line"><span class="attr">spring.mail.username</span>=<span class="string">test200307@sina.com</span></span><br><span class="line"><span class="attr">spring.mail.password</span>=<span class="string">b5461c675f1e64e4</span></span><br><span class="line"><span class="attr">spring.mail.protocol</span>=<span class="string">smtps</span></span><br><span class="line"><span class="comment">#s(safe)</span></span><br><span class="line"><span class="attr">spring.mail.properties.mail.smtp.ssl.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.mail.properties.mail.smtp.starttls.required</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p>定义封装邮件邮件操作的类（复用）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">封装发邮件</span></span><br><span class="line"><span class="comment">* 发送人：配置文件里的邮箱，为了方便还用@Value注入给了属性</span></span><br><span class="line"><span class="comment">* 收信人：</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger=LoggerFactory.getLogger(MailClient.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String from;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMail</span><span class="params">(String to,String subject,String content)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> mailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper helper=<span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message);</span><br><span class="line">            helper.setFrom(from);<span class="comment">//发信人</span></span><br><span class="line">            helper.setTo(to);<span class="comment">//收信人</span></span><br><span class="line">            helper.setSubject(subject);<span class="comment">//邮件主题</span></span><br><span class="line">            helper.setText(content,<span class="literal">true</span>);<span class="comment">//邮件内容</span></span><br><span class="line"></span><br><span class="line">            mailSender.send(helper.getMimeMessage());<span class="comment">//发送邮件</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (MessagingException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;发送邮件失败 &quot;</span>+e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MailClient mailClient;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTextMail</span><span class="params">()</span>&#123;</span><br><span class="line">        mailClient.sendMail(<span class="string">&quot;收信人邮箱&quot;</span>,<span class="string">&quot;标题&quot;</span>,<span class="string">&quot;内容&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>发送html邮件：</p>
<p>thymeleaf模板demo.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎使用mail<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>欢迎你，<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> MailClient mailClient;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHtmlMail</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">       context.setVariable(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;purin^^&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> templateEngine.process(<span class="string">&quot;/mail/demo.html&quot;</span>, context);<span class="comment">//用thymemleaf模板生成html，作为邮件内容</span></span><br><span class="line">       System.out.println(content);</span><br><span class="line">       mailClient.sendMail(<span class="string">&quot;收信人邮箱&quot;</span>,<span class="string">&quot;标题&quot;</span>,content);<span class="comment">//发邮件</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>控制台（打印出了html页面代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;欢迎使用mail&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;欢迎你，&lt;span style=&quot;color: red&quot;&gt;purin^^&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><img src="../images/image-20240330215434052.png" alt="image-20240330215434052" style="zoom:33%;" />

<p>按照请求可以<strong>划分为三个过程</strong>（拆解）</p>
<ul>
<li>点击”注册“，向服务器请求注册页面</li>
<li>填写完注册信息后，点”注册“，向服务器请求，注册成功则存下来数据</li>
<li>注册完后，服务器发邮件激活账号，点击激活链接，请求激活服务</li>
</ul>
<hr>
<h3 id="遇见的问题"><a href="#遇见的问题" class="headerlink" title="遇见的问题"></a>遇见的问题</h3><p>访问register无法访问【仍然是whitelabel error，caused by ”EL1007E: Property totalRows cannot be found on null“index 144行】</p>
<p>怎么找也没找到哪出错，测试controller里的totalRows并不为null，把源码的index.html粘贴过来解决问题（但我没找出来index哪里和源码不一样）</p>
<hr>
<h3 id="1-访问注册页面"><a href="#1-访问注册页面" class="headerlink" title="1.访问注册页面"></a>1.访问注册页面</h3><p>点击“注册”，对应thymeleaf模板代码为<code>&lt;a class=&quot;nav-link&quot; th:href=&quot;@&#123;/register&#125;&quot;&gt;注册&lt;/a&gt;</code>，跳转到<code>http://localhost:8080/community/register</code></p>
<p>编写Controller里的对应路径的handler(跳转给register.html)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path=&quot;register&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRegisterPage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span><span class="string">&quot;/site/register&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-提交注册数据"><a href="#2-提交注册数据" class="headerlink" title="2.提交注册数据"></a>2.提交注册数据</h3><ul>
<li>表单提交数据</li>
<li>判断用户是否已存在</li>
<li>服务端发送激活邮件</li>
</ul>
<p>用<strong>Model对象</strong>给tyhmeleaf模板传参</p>
<h4 id="2-1-表单提交数据"><a href="#2-1-表单提交数据" class="headerlink" title="2.1 表单提交数据"></a>2.1 表单提交数据</h4><p>register.html模板页面</p>
<ul>
<li><p><code>&lt;header class=&quot;bg-dark sticky-top&quot; th:replace=&quot;index::header&quot;&gt;</code></p>
<ul>
<li><code>th:replace=&quot;index::header&quot;</code>复用index页面的header(因为有许多相对路径需要修改成thymeleaf语法格式比较麻烦，所以复用了)</li>
<li><code>th:fragment=&quot;header&quot;</code>被复用的代码tag里写</li>
</ul>
</li>
<li><pre><code>&lt;input type=&quot;text&quot;
      th:class=&quot;|form-control $&#123;usernameMsg!=null?&#39;is-invalid&#39;:&#39;&#39;&#125;|&quot;
      th:value=&quot;$&#123;user!=null?user.username:&#39;&#39;&#125;&quot;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - `th:value`默认值，`$&#123;user!=null?user.username:&#x27;&#x27;&#125;`如果失败一次后跳回这个页面就可以自动取到model里存的user，就不用再输入了</span><br><span class="line"></span><br><span class="line">#### 2.2判断用户是否已经存在</span><br><span class="line"></span><br><span class="line">- 接收到的数据封装成user对象</span><br><span class="line">- map存msg，据此判断是否注册成功，以及下一步的操作</span><br><span class="line">- 判断提交数据是否合法</span><br><span class="line">  - 是否为空</span><br><span class="line">  - 是否数据库中已有该username或email</span><br><span class="line">- 合法则注册成功，map.`isEmpty()`==true,并发送激活邮件；不合法则注册失败，map内添加mag信息</span><br><span class="line"></span><br><span class="line">- Coontroller调用service层方法，接收到service方法的返回值为map类型</span><br><span class="line">  - map为空--注册成功--跳转到主页，并受到激活邮件</span><br><span class="line">  - map不为空--存着失败的提示信息--注册失败，继续转到register页面，但是由于thymeleaf模板页面的设置，以及springmvc把形参user存到model里，致使注册失败后跳转到register可以从$&#123;user.username&#125;直接取到上次输入的数据`$&#123;user!=null?user.username:&#x27;&#x27;&#125;`</span><br><span class="line"></span><br><span class="line">service：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">//map注册结果的反馈</span><br><span class="line">    public Map&lt;String,Object&gt;register(User user) &#123;//封装填写的注册信息为user对象</span><br><span class="line">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        //判断账号密码是否合法</span><br><span class="line">        if(user==null)&#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;参数不能为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //业务漏洞，所以没抛异常，把提示信息放起来map</span><br><span class="line">        if(StringUtils.isBlank(user.getUsername()))&#123;</span><br><span class="line">            map.put(&quot;usernameMsg&quot;,&quot;用户名不能为空&quot;);</span><br><span class="line">            return map;</span><br><span class="line">        &#125;</span><br><span class="line">        if(StringUtils.isBlank(user.getPassword()))&#123;</span><br><span class="line">            map.put(&quot;passwordMsg&quot;,&quot;密码不能为空&quot;);</span><br><span class="line">            return map;</span><br><span class="line">        &#125;</span><br><span class="line">        if(StringUtils.isBlank(user.getEmail()))&#123;</span><br><span class="line">            map.put(&quot;emailMsg&quot;,&quot;邮箱不能为空&quot;);</span><br><span class="line">            return map;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //验证账号是否已经存在</span><br><span class="line">        //因为主键id是自增的，所以不用设置，也就不用验证</span><br><span class="line">        User u=userMapper.selectByName(user.getUsername());</span><br><span class="line">        if(u!=null)&#123;</span><br><span class="line">            map.put(&quot;usernameMsg&quot;,&quot;该账户已存在&quot;);</span><br><span class="line">            return map;</span><br><span class="line">        &#125;</span><br><span class="line">        u=userMapper.selectByEmail(user.getEmail());</span><br><span class="line">        if(u!=null)&#123;</span><br><span class="line">            map.put(&quot;emailMsg&quot;,&quot;该邮箱已存在&quot;);</span><br><span class="line">            return map;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //全都没有问题，注册</span><br><span class="line">        user.setSalt(CommunityUtil.getUUID().substring(0,5));//在密码后边拼的那串随机字符</span><br><span class="line">        user.setPassword(CommunityUtil.md5(user.getPassword()+user.getSalt()));//存储加密后的密码</span><br><span class="line">        user.setType(0);</span><br><span class="line">        user.setStatus(0);//未被激活</span><br><span class="line">        user.setActivationCode(CommunityUtil.getUUID());//激活码</span><br><span class="line">        //默认头像,%d占位符 表示数字，new Random().nextInt(1000)生成1000内的随机数</span><br><span class="line">        user.setHeaderUrl(String.format(&quot;http://images.nowcoder.com/head/%dt.png&quot;,new Random().nextInt(1000)));</span><br><span class="line">        user.setCreateTime(new Date());</span><br><span class="line">        //调用insert添加到数据库里</span><br><span class="line">        userMapper.insertUser(user);</span><br><span class="line"></span><br><span class="line">        //发激活邮件</span><br><span class="line">        Context context = new Context();</span><br><span class="line">        //因为对应的activation.html模板就是需要传入email和激活url，所以setVariable设置这俩</span><br><span class="line">        context.setVariable(&quot;email&quot;,user.getEmail());</span><br><span class="line">        //激活url需要动态拼出来</span><br><span class="line">        String url=domain+contextPath+&quot;/activation/&quot;+user.getId()+&quot;/&quot;+user.getActivationCode();</span><br><span class="line">        context.setVariable(&quot;url&quot;,url);</span><br><span class="line">        String content=templateEngine.process(&quot;/mail/activation&quot;,context);//content邮件内容</span><br><span class="line">        mailClient.sendMail(user.getEmail(),&quot;激活账号&quot;,content);</span><br><span class="line">        System.out.println(&quot;service-是否map==null:&quot;+(map==null));//false</span><br><span class="line">        return map;//map为空，则没有任何问题</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path=&quot;register&quot;,method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(Model model, User user)</span>&#123;<span class="comment">//model携带数据传给模板</span></span><br><span class="line">        <span class="comment">//springmvc会自动把值注入给形参里的user对象</span></span><br><span class="line">        Map&lt;String, Object&gt; map = userService.register(user);<span class="comment">//根据返回的map进一步选择给浏览器做出怎样的响应</span></span><br><span class="line">        <span class="comment">//System.out.println(&quot;Controller-是否map==null:&quot;+(map==null));//false,所以问题出在返回的map为空</span></span><br><span class="line">        <span class="comment">//System.out.println(map.toString());//&#123;&#125;</span></span><br><span class="line">        <span class="keyword">if</span>(map==<span class="literal">null</span>||map.isEmpty())&#123;<span class="comment">//注册成功[注册成功后跳转到首页，激活成功后跳到登录]</span></span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;注册成功，请在邮箱激活账号&quot;</span>);</span><br><span class="line">            model.addAttribute(<span class="string">&quot;target&quot;</span>,<span class="string">&quot;/index&quot;</span>);</span><br><span class="line">            <span class="comment">//System.out.println(&quot;map==null&quot;+(map==null));这句没输出，合理怀疑map!=null</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/site/operate-result&quot;</span>;<span class="comment">//动态的中间人模板页面</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//注册失败</span></span><br><span class="line">            model.addAttribute(<span class="string">&quot;usernameMsg&quot;</span>,map.get(<span class="string">&quot;usernameMsg&quot;</span>));</span><br><span class="line">            model.addAttribute(<span class="string">&quot;emailMsg&quot;</span>,map.get(<span class="string">&quot;emailMsg&quot;</span>));</span><br><span class="line">            model.addAttribute(<span class="string">&quot;passwordMsg&quot;</span>,map.get(<span class="string">&quot;passwordMsg&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/site/register&quot;</span>;</span><br><span class="line">            <span class="comment">/*当注册失败跳回register页面时，页面可以直接使用user对象(形参)，</span></span><br><span class="line"><span class="comment">            因为springmv在走这个方法时就把user放到了model里*/</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="遇见的问题-1"><a href="#遇见的问题-1" class="headerlink" title="遇见的问题"></a>遇见的问题</h4><p>注册成功后没跳转到提示的中间过渡页面，仍留在register</p>
<blockquote>
<p>判断map是否为空写成了“map&#x3D;&#x3D;null”</p>
<ul>
<li>map&#x3D;&#x3D;null是判断有没有给map对象分配空间</li>
<li>map.isEmpty（）判断map对象内的k-v是否为空</li>
</ul>
</blockquote>
<h3 id="3-激活"><a href="#3-激活" class="headerlink" title="3.激活"></a>3.激活</h3><ul>
<li>即把用户状态(status)改为1，dao层</li>
<li>在service写个业务方法</li>
<li>激活成功，激活失败(比如伪造激活码)，已经激活过了重复激活（三个常量，放到常量接口里）</li>
</ul>
<p>常量接口(激活状态的常量)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 常量接口（激活状态的常量）</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CommunityConstant</span> &#123;</span><br><span class="line">    <span class="type">int</span> ACTIVATION_SUCCESSS=<span class="number">0</span>;<span class="comment">//成功</span></span><br><span class="line">    <span class="type">int</span> ACTIVATION_REPEAT=<span class="number">1</span>;<span class="comment">//重复</span></span><br><span class="line">    <span class="type">int</span> ACTIVATION_FAILURE=<span class="number">2</span>;<span class="comment">//失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">CommunityConstant</span> &#123;</span><br><span class="line">    <span class="comment">//实现常量接口，因为要用激活常量</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">activation</span><span class="params">(<span class="type">int</span> userId,String code)</span>&#123;</span><br><span class="line">        <span class="comment">//先查有没有这个用户，再查激活码是否正确</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        System.out.println(user.getUsername());<span class="comment">//purin</span></span><br><span class="line">        <span class="comment">//System.out.println(&quot;status&quot;+user.getStatus());//status0,说明目前没问题,问题出在没用equals，用了==</span></span><br><span class="line">        <span class="keyword">if</span>(user.getStatus()==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ACTIVATION_REPEAT;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(user.getActivationCode().equals(code))&#123;</span><br><span class="line">            userMapper.updateStatus(userId,<span class="number">1</span>);<span class="comment">//修改状态为激活成功</span></span><br><span class="line">            <span class="comment">//因为要修改数据库信息，所以用mapper，我差点就写成user.setStatus了，有个毛用</span></span><br><span class="line">            <span class="keyword">return</span> ACTIVATION_SUCCESSS;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">return</span> ACTIVATION_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//激活路径：String url=domain+contextPath+&quot;/activation/&quot;+user.getId()+&quot;/&quot;+user.getActivationCode();</span></span><br><span class="line">    <span class="meta">@RequestMapping(path=&quot;activation/&#123;userId&#125;/&#123;code&#125;&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">activation</span><span class="params">(Model model, <span class="meta">@PathVariable(&quot;userId&quot;)</span><span class="type">int</span> userId,</span></span><br><span class="line"><span class="params">                             <span class="meta">@PathVariable(&quot;code&quot;)</span>String code)</span>&#123;<span class="comment">//从路径中取值当参数，@PathVariable</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> userService.activation(userId, code);</span><br><span class="line">        <span class="comment">//debug用的System.out.println(&quot;激活结果：&quot;+res);//激活结果：2,激活失败--回去service找错误</span></span><br><span class="line">        <span class="keyword">if</span>(res==ACTIVATION_SUCCESSS)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;激活成功，跳转到登陆页面&quot;</span>);</span><br><span class="line">            model.addAttribute(<span class="string">&quot;target&quot;</span>,<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res==ACTIVATION_REPEAT)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;这是无效的操作，账号已经被激活过了&quot;</span>);</span><br><span class="line">            model.addAttribute(<span class="string">&quot;target&quot;</span>,<span class="string">&quot;/index&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;激活失败，激活码不正确&quot;</span>);</span><br><span class="line">            model.addAttribute(<span class="string">&quot;target&quot;</span>,<span class="string">&quot;/index&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/site/operate-result&quot;</span>;<span class="comment">//中间过渡页面</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="遇到的问题："><a href="#遇到的问题：" class="headerlink" title="遇到的问题："></a>遇到的问题：</h4><p>1.点开激活账号的链接：</p>
<img src="../images/image-20240331163352887.png" alt="image-20240331163352887" style="zoom:33%;" />

<blockquote>
<p>【url问题】<a target="_blank" rel="noopener" href="https://blog.csdn.net/zht741322694/article/details/79688728">浏览器请求spring-boot模块项目报:There was an unexpected error (type&#x3D;Not Found, status&#x3D;404).-CSDN博客</a></p>
<ul>
<li>properties文件里community.path.domain配多了一个“&#x2F;community”,只配“<code>http://localhost:8080</code>”就行</li>
<li>然后再重新部署点击也不行，因为链接是之前发的，还是同一个链接，即url还是不对，删了重新注册</li>
</ul>
</blockquote>
<p>2.url对了，但是激活失败</p>
<img src="../images/image-20240331171622206.png" alt="image-20240331171622206" style="zoom:33%;" />

<ul>
<li>先在service打印用户status–&gt;0未激活</li>
<li>controller打印res–&gt;2激活失败</li>
<li>检查发现，判断激活码(String)的语句有问题<ul>
<li><strong>比较string内容</strong>是否相等应该用<code>equals()</code>,<code>==</code>比较的是内存地址，即是否是同一个对象</li>
</ul>
</li>
</ul>
<h2 id="会话管理"><a href="#会话管理" class="headerlink" title="会话管理"></a>会话管理</h2><ul>
<li>HTTP无状态，多个请求之间没有联系（因为服务器无法识别浏览器）</li>
<li>利用cookie可创建有状态的会话（让服务器可以识别浏览器<ul>
<li>k-v，且只能存<strong>字符串</strong><ul>
<li>因为cookie每次访问都带着，大了太浪费资源</li>
</ul>
</li>
</ul>
</li>
<li>服务器创建cookie，浏览器保存cookie<ul>
<li>默认<strong>关闭浏览器后</strong>，cookie就没了（一次会话）【存在内存里】</li>
<li>设置<strong>cookie生存时间</strong>后可以不止一次会话内【存在硬盘里】</li>
<li><code>cookie.setMaxAge(60*分钟数)</code></li>
</ul>
</li>
</ul>
<img src="../images/image-20240331174810188.png" alt="image-20240331174810188" style="zoom:33%;" />

<p>demo:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path=&quot;/cookie/set&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span><span class="comment">//返回字符串，不用视图解释器了/即不返回页面</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">setCookie</span><span class="params">(HttpServletResponse response)</span>&#123;<span class="comment">//cookie加到响应头里</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;code&quot;</span>, CommunityUtil.getUUID());<span class="comment">//只有有参构造，参数为k-v</span></span><br><span class="line">        <span class="comment">//设置cookie有效的范围(用不到的时候就不传cookie，节约资源)</span></span><br><span class="line">        cookie.setPath(<span class="string">&quot;/community/alpha&quot;</span>);<span class="comment">//也即访问路径</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">10</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<img src="../images/image-20240331180927822.png" alt="image-20240331180927822" style="zoom:33%;" />

<ul>
<li>服务器把cookie加到响应头里，下次浏览器再访问就会带着（在请求里<img src="../images/image-20240331185134231.png" alt="image-20240331185134231" style="zoom:33%;" /></li>
</ul>
<hr>
<p>利用注解取cookie</p>
<ul>
<li><pre><code>@CookieValue(&quot;code&quot;)String code
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 用注解取出名为“code”的cookie赋值给形参code</span><br><span class="line"></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">cookie不适合存密码之类的隐私信息，因为存在客户端，不安全。</span><br><span class="line"></span><br><span class="line">**Session**:</span><br><span class="line"></span><br><span class="line">- javaEE标准，在服务端记录</span><br><span class="line">- 数据存放在服务端比较安全，但是也会增加服务器的内存压力</span><br><span class="line"></span><br><span class="line">- 在session存东西时，servlet会自动生成jsessionid（cookie）发给客户端</span><br><span class="line"></span><br><span class="line">- 客户端和服务器是多对一关系，这样服务器用cookie当作标识(存**sessionid**)区分不同的客户端。客户端带着sessionid(cookie)去，服务器根据sessionid去内存找对应的session(存具体数据)</span><br><span class="line"></span><br><span class="line">- session可以存任何类型的内容，cookie只能存string(因为cookie来回传)</span><br><span class="line"></span><br><span class="line">- **分布式部署时不用session**（多台服务器）</span><br><span class="line"></span><br><span class="line">  - 因为分布式，负载均衡，每次访问的服务器不一定，可能别的服务器没有该session</span><br><span class="line"></span><br><span class="line">  - &lt;img src=&quot;../images/image-20240331192223984.png&quot; alt=&quot;image-20240331192223984&quot; style=&quot;zoom:33%;&quot; /&gt;</span><br><span class="line">  - 解决方案：尽量不用session，去使用cookie；实在隐秘的数据，存储到数据库里。但是数据库访问硬盘很慢，用redis。</span><br><span class="line">  - &lt;img src=&quot;../images/image-20240331192821768.png&quot; alt=&quot;image-20240331192821768&quot; style=&quot;zoom:33%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  往session里存数据时，服务器会给客户端发sessionid的cookie</span><br><span class="line"></span><br><span class="line">  &lt;img src=&quot;../images/image-20240331193523093.png&quot; alt=&quot;image-20240331193523093&quot; style=&quot;zoom:50%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  demo:</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  @RequestMapping(path=&quot;/session/set&quot;,method = RequestMethod.GET)</span><br><span class="line">      @ResponseBody</span><br><span class="line">      public String setSession(HttpSession session)&#123;///session会自动注入</span><br><span class="line">          session.setAttribute(&quot;age&quot;,1);</span><br><span class="line">          session.setAttribute(&quot;name&quot;,&quot;purin&quot;);</span><br><span class="line">          return &quot;setsession ok&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      @RequestMapping(path=&quot;/session/get&quot;,method = RequestMethod.GET)</span><br><span class="line">      @ResponseBody</span><br><span class="line">      public String getSession(HttpSession session)&#123;</span><br><span class="line">          System.out.println(session.getAttribute(&quot;age&quot;));</span><br><span class="line">          System.out.println(session.getAttribute(&quot;name&quot;));</span><br><span class="line">          return &quot;getsession ok&quot;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h2 id="生成验证码"><a href="#生成验证码" class="headerlink" title="生成验证码"></a>生成验证码</h2><p>kaptcha</p>
<p><a target="_blank" rel="noopener" href="https://code.google.com/archive/p/kaptcha/">Google Code Archive - Long-term storage for Google Code Project Hosting.</a></p>
<ul>
<li>导包</li>
<li>写配置（配置类内）</li>
</ul>
<blockquote>
<p>ctrl+n:搜索</p>
<p>producer接口</p>
<img src="../images/image-20240331195713102.png" alt="image-20240331195713102" style="zoom:33%;" />

<p>实现类：<img src="../images/image-20240331195740507.png" alt="image-20240331195740507" style="zoom:33%;" /></p>
</blockquote>
<p>配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KaptchaConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Producer <span class="title function_">kaptchaProducer</span><span class="params">()</span>&#123;<span class="comment">//方法名即bean名</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//kaptcha配置</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.width&quot;</span>,<span class="string">&quot;100&quot;</span>);<span class="comment">//100px</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.heigth&quot;</span>,<span class="string">&quot;40&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.color&quot;</span>,<span class="string">&quot;black&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.size&quot;</span>,<span class="string">&quot;32&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.string&quot;</span>,<span class="string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>);<span class="comment">//字符范围</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.strength&quot;</span>,<span class="string">&quot;4&quot;</span>);<span class="comment">//验证码长度</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.noise.impl&quot;</span>,<span class="string">&quot;com.google.code.kaptcha.impl.NoNoise&quot;</span>);<span class="comment">//验证码的模糊干扰效果</span></span><br><span class="line"></span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">kaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>(properties);</span><br><span class="line">        kaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> kaptcha;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生成验证码："><a href="#生成验证码：" class="headerlink" title="生成验证码："></a>生成验证码：</h3><ul>
<li><p>生成的验证码放在客户端不安全，放到服务器，所以有多个请求间的联系，用cookie和session技术</p>
</li>
<li><p>文字验证码存到session，图片验证码显示出来给浏览器</p>
</li>
<li><pre><code class="java">@Autowired
    private Producer kaptchaProducer;//注入

@RequestMapping(path=&quot;kaptcha&quot;,method=RequestMethod.GET)
public void kaptcha(HttpServletResponse response, HttpSession session)&#123;
    //不需要返回页面或字符串，利用rsponse，所以返回值void
    //生成的验证码放在客户端不安全，放到服务器，所以有多个请求间的联系，用cookie和session技术
    //生成验证码
    String text = kaptchaProducer.createText();
    BufferedImage image = kaptchaProducer.createImage(text);
    //把文字验证码存到session
    session.setAttribute(&quot;kaptcha&quot;,text);
    //图片给浏览器显示出来
    response.setContentType(&quot;image/png&quot;);
    try &#123;
        ServletOutputStream stream = response.getOutputStream();//图片用字节流比较好
        ImageIO.write(image,&quot;png&quot;,stream);
    &#125; catch (IOException e) &#123;
        logger.error(&quot;相应验证码失败&quot;+e.getMessage());
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 打日志需要`private static final Logger logger= LoggerFactory.getLogger(LoginController.class);//打日志`</span><br><span class="line"></span><br><span class="line">访问xx/xx/kaptcha有：&lt;img src=&quot;../images/image-20240331210712322.png&quot; alt=&quot;image-20240331210712322&quot; style=&quot;zoom:33%;&quot; /&gt;，即为通过response向浏览器输出的内容</span><br><span class="line"></span><br><span class="line">### 使用验证码：</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;div class=&quot;col-sm-4&quot;&gt;</span><br><span class="line">    &lt;img id=&quot;kaptcha&quot; th:src=&quot;@&#123;/kaptcha&#125;&quot; style=&quot;width:100px;height:40px;&quot; class=&quot;mr-2&quot;/&gt;</span><br><span class="line">    &lt;a href=&quot;javascript:refresh_kaptcha();&quot; class=&quot;font-size-12 align-bottom&quot;&gt;刷新验证码&lt;/a&gt;</span><br><span class="line">    &lt;!--点击刷新验证码时调用这个javascript方法--&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>对应的refresh_kaptcha()方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">		<span class="keyword">function</span> <span class="title function_">refresh_kaptcha</span>(<span class="params"></span>) &#123;</span><br><span class="line">			<span class="keyword">var</span> path = <span class="variable constant_">CONTEXT_PATH</span> + <span class="string">&quot;/kaptcha?p=&quot;</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">			$(<span class="string">&quot;#kaptcha&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, path);</span><br><span class="line">		&#125;</span><br><span class="line">	&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>其实<code>CONTEXT_PATH+&quot;/kaptcha&quot;</code>和<code>th:src=&quot;@&#123;/kaptcha&#125;</code>路径一样，浏览器会以为路径没变，所以就不会更新验证码，<br>        p的作用是为了欺骗浏览器，然浏览器以为路径变了，然后就能达到刷新验证码的效果，其实p本身没有什么意义</p>
</li>
<li><p><code>$&#123;&quot;#kaptcha&quot;&#125;.attr(&quot;src&quot;,path);</code><br>        &#x2F;<em>通过id选择器获取该tag，再修改src属性，attr即attribute</em>&#x2F;<br>          &#x2F;<em>改变图片路径，即相当于重新加载了验证码图片-&gt;更改了验证码</em>&#x2F;</p>
</li>
</ul>
<h2 id="登录，-退出登录"><a href="#登录，-退出登录" class="headerlink" title="登录， 退出登录"></a>登录， 退出登录</h2><img src="../images/image-20240402180450811.png" alt="image-20240402180450811" style="zoom:33%;" />

<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>登陆凭证的表：<img src="../images/image-20240402181441760.png" alt="image-20240402181441760" style="zoom:33%;" /></p>
<ul>
<li><u>ticket是核心数据</u>，服务器通过cookie发给浏览器。其他的数据在服务器自己存着。</li>
<li>相当于：一整条数据是session，ticket是cookie</li>
<li>下次访问时，浏览器带着ticket(cookie),服务器根据ticket去看对应的其他信息</li>
<li><strong>退出</strong>登录时–&gt;把ticket对应的<strong>status改为失效</strong></li>
</ul>
<hr>
<ul>
<li>养成写完mapper方法就在test测试类里测试mapper是否能成功操作数据库的好习惯</li>
</ul>
<hr>
<p>登录service方法：</p>
<ul>
<li>返回Map&lt;String,Object&gt;，存msg信息，方便下一步操作怎么做</li>
<li>数据库中psw存的加密后的，用户登录时提交的psw是铭文，需要把psw加密后与数据库作比较</li>
<li>先做空串判断（username，psw是否为空字符串）<ul>
<li><code>StringUtils.isBlank(str)</code></li>
</ul>
</li>
<li>再做合法性判断<ul>
<li>数据库中有没有该用户：mapper层方法返回User对象，判断是否为null（即按照username查找能不能查到该用户）</li>
<li>如果有再是否已激活</li>
<li>验证密码</li>
</ul>
</li>
</ul>
<hr>
<p>登录视图层controller</p>
<ul>
<li>先验证<strong>验证码</strong><ul>
<li><code>!kaptcha.equalsIgnoreCase(code))</code>效果同equals()且忽略大小写</li>
</ul>
</li>
<li>再验证账号密码（调用service层方法</li>
</ul>
<hr>
<ul>
<li><p>controller方法中，如果形参有类实体对象，会被自动装配进model对象，可以直接在thymeleaf模板页面取实体对象</p>
</li>
<li><p>如果形参是基本类型对象，不会被装进model里</p>
<ul>
<li><p>solution1 手动加进model里</p>
</li>
<li><p>solution2 从request对象里取（因为表单参数随着请求被传了过来</p>
<ul>
<li><pre><code class="java">$&#123;param.username&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 底层相当于：**request**.getParam(&quot;username&quot;)</span><br><span class="line"></span><br><span class="line">-----------</span><br><span class="line"></span><br><span class="line">### bug</span><br><span class="line"></span><br><span class="line">登陆页面点击登陆后：&lt;img src=&quot;../images/image-20240402212216264.png&quot; alt=&quot;image-20240402212216264&quot; style=&quot;zoom:33%;&quot; /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Caused by: org.springframework.expression.spel.SpelEvaluationException: EL1007E: Property or field ‘totalRows’ cannot be found on null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">又是历史遗留问题，翻看了上次解决方案是粘贴了源码的index.html,但我后来也没修改index.html啊，，，</span><br><span class="line"></span><br><span class="line">- 而且login_ticket表里成功添加登陆凭证，感觉和后端代码没关系，，还是前端代码，，，先放着，明天再解决吧</span><br><span class="line"></span><br><span class="line">24.4.7复制源码先过去了</span><br><span class="line"></span><br><span class="line">### logout</span><br><span class="line"></span><br><span class="line">- 登陆凭证状态改为失效（login时已经写了dao层updateStatus()</span><br><span class="line">- 跳转到首页</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@RequestMapping(path = &quot;/logout&quot;, method = RequestMethod.GET)</span><br><span class="line">    public String logout(@CookieValue(&quot;ticket&quot;) String ticket) &#123;</span><br><span class="line">        userService.logout(ticket);</span><br><span class="line">        return &quot;redirect:/login&quot;;//重定向</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@CookieValue(&quot;ticket&quot;) String ticket</code>取名为ticket的cookie的值赋给形参tiicket</li>
</ul>
<h2 id="显示登陆信息"><a href="#显示登陆信息" class="headerlink" title="显示登陆信息"></a>显示登陆信息</h2><img src="../images/image-20240407175637429.png" alt="image-20240407175637429" style="zoom:33%;" />

<ul>
<li>网页头部根据登陆与否显示不同头部<ul>
<li>用拦截器在请求开始之前、结束做处理，批量解决共有的问题</li>
</ul>
</li>
</ul>
<hr>
<h3 id="拦截器的使用"><a href="#拦截器的使用" class="headerlink" title="拦截器的使用"></a>拦截器的使用</h3><p>拦截器实现HandlerInterceptoor接口，表明这是一个自定义的拦截器</p>
<ul>
<li><p>重写方法</p>
<ul>
<li>preHandle controller之前执行</li>
<li>postHandle controller之后执行，模板之前执行</li>
<li>afterCompletion 模板之后执行</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlphaInterceptor</span>  <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">	<span class="comment">//用于打日志</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger= LoggerFactory.getLogger(AlphaInterceptor.class);</span><br><span class="line">    <span class="comment">//@controller之前执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;preHandle &quot;</span>+handler.toString());<span class="comment">///打日志，用于调试</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//@controller之后执行,模板之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;postHandler &quot;</span>+handler.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//模板之后</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;afterCompletion &quot;</span>+handler.toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>配置类实现WebMvcConfigurer接口，注册自定义的拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebmvcConnfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlphaInterceptor alphaInterceptor;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(alphaInterceptor)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/**/*.jpg&quot;</span>,<span class="string">&quot;/**/*.png&quot;</span>,<span class="string">&quot;/**/*.js&quot;</span>,<span class="string">&quot;/**/*.css&quot;</span>)<span class="comment">/*拦截器排除静态资源，即不拦截*/</span></span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/login&quot;</span>);<span class="comment">//拦截的路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问login页面后，在控制台发现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[AlphaInterceptor.java:20] preHandle public java.lang.String com.nowcoder.community.controller.LoginController.getLoginPage()</span><br><span class="line">[AlphaInterceptor.java:27] postHandler public java.lang.String com.nowcoder.community.controller.LoginController.getLoginPage()</span><br><span class="line">[AlphaInterceptor.java:33] afterCompletion public java.lang.String com.nowcoder.community.controller.LoginController.getLoginPage()</span><br></pre></td></tr></table></figure>

<p>即拦截器成功发挥作用，其中打印的Object对象handler<code>即LoginController.getLoginPage()</code>表示login方法（即拦截目标handler就是对应的方法）</p>
<hr>
<h3 id="业务思路："><a href="#业务思路：" class="headerlink" title="业务思路："></a>业务思路：</h3><img src="../images/image-20240410141445854.png" alt="image-20240410141445854" style="zoom:33%;" />

<p>请求逻辑如上图，</p>
<ul>
<li>请求一开始就需要根据用户cookie（即ticket）去数据库查询对应loginTicket，进一步user信息，并封装起来供使用【preHandle】<ul>
<li>取cookie需要从request里，比较麻烦，可以封装到util类里，写了个CookieUtil类</li>
<li>获取到user对象后要存起来后期使用，易知一次会话中对服务器可以有多个请求，<u>是个多线程的过程，每次请求服务器都会创建一个线程，容易产生并发问题</u>，使用<strong>ThreadLocal</strong>存(线程隔离)<ul>
<li>只要当前线程(request)还没结束，存的user就能拿到</li>
<li><u>调用模板引擎之前</u>（postHandle）用存的user，因为在模板引擎里要用到，通过存到model可以从模板引擎取</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>且每次请求都走一个这样的过程，所以可以写到拦截器里，就不用重复写代码了。</p>
<h3 id="思路整理："><a href="#思路整理：" class="headerlink" title="思路整理："></a>思路整理：</h3><p>1.页面的header根据登陆与否显示不同信息，而且从model拿user来判断是否已登陆，且每次请求都要根据是否登录而判断–&gt;写到拦截器里来复用</p>
<p>2.拦截器的preHandle 来根据用户请求携带的cookie获取用户信息并封装成user对象，存到hostholder里。</p>
<p>postHandle在模板之前执行，取出之前存储的user对象，并放进model里供模板引擎使用。</p>
<p>postCompletion在访问完模板执行，写清空语句，防止占用太多资源</p>
<ul>
<li>hostholder起容器作用，持有用户数据，用于代替session对象</li>
</ul>
<p>hostholder：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HostHolder</span> &#123;</span><br><span class="line">    <span class="comment">//ThreadLocal set()get()源码以线程为key存取值（?）</span></span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;User&gt; users=<span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        users.set(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>&#123;</span><br><span class="line">        users.remove();<span class="comment">//用完之后把当前线程的都清掉（防止占用太多资源</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拦截器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginTicketInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HostHolder hostHolder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String ticket= CookieUtil.getValue(request,<span class="string">&quot;ticket&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(ticket!=<span class="literal">null</span>)&#123;<span class="comment">//登陆成功</span></span><br><span class="line">            <span class="comment">//获取凭证</span></span><br><span class="line">            <span class="type">LoginTicket</span> <span class="variable">loginTicket</span> <span class="operator">=</span> userService.findLoginTicket(ticket);</span><br><span class="line">            <span class="comment">//判断凭证是否有效</span></span><br><span class="line">            <span class="keyword">if</span>(loginTicket!=<span class="literal">null</span>&amp;&amp;loginTicket.getStatus()==<span class="number">0</span>&amp;&amp;loginTicket.getExpired().after(<span class="keyword">new</span> <span class="title class_">Date</span>()))&#123;</span><br><span class="line">                <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findUserById(loginTicket.getUserId());</span><br><span class="line">                hostHolder.setUser(user);<span class="comment">//存起来</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        User user= hostHolder.getUser();<span class="comment">//拿到存的user</span></span><br><span class="line">        <span class="comment">//System.out.println(&quot;user!=null:&quot;+(user!=null));</span></span><br><span class="line">        <span class="comment">//System.out.println(&quot;modelAndView!=null&quot;+(modelAndView!=null));</span></span><br><span class="line">        <span class="keyword">if</span>(user!=<span class="literal">null</span>&amp;&amp;modelAndView!=<span class="literal">null</span>)&#123;</span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;loginUser&quot;</span>,user);<span class="comment">//加入model，以便模板页面中去使用</span></span><br><span class="line">            <span class="comment">//System.out.println(&quot;there is postHandle::::username is &quot;+user.getUsername());</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        hostHolder.clear();<span class="comment">//模板执行完之后，清掉存的user，防止只用不清站太多资源</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.修改模板语句，添加<code>th:if=&quot;$&#123;loginUser==null&#125;&quot;``th:if=&quot;$&#123;loginUser!=null&#125;&quot;</code>来根据是否登录而选择是否显示某一项头部栏</p>
<h2 id="设置账号信息"><a href="#设置账号信息" class="headerlink" title="设置账号信息"></a>设置账号信息</h2><img src="../images/image-20240410155713880.png" alt="image-20240410155713880" style="zoom:33%;" />

<ul>
<li>上传表单时提交方法POST</li>
</ul>
<h3 id="业务思路：-1"><a href="#业务思路：-1" class="headerlink" title="业务思路："></a>业务思路：</h3><p>先把图片上传到服务器（此处以本机d:&#x2F;purin&#x2F;upload目录为例），获取图片时用输入流读取文件，用输出流向页面输出。</p>
<p>修改头像：</p>
<p>需要service层方法修改headerUrl，使用springmvc的MultipartFile上传文件【<strong>必须在controller层，MultipartFile是表现层对象</strong>】</p>
<p>为了防止用户上传的图片出现同样命名的冲突，需要自己随机生成一个图片名，但保留后缀。</p>
<p>配置上传文件的存放路径</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">community.path.upload</span>=<span class="string">d:/purin/upload</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/upload&quot;,method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadHeader</span><span class="params">(MultipartFile headerImage, Model model)</span>&#123;<span class="comment">//model给模板传值</span></span><br><span class="line">        <span class="keyword">if</span>(headerImage==<span class="literal">null</span>)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;您还未选择图片&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/user/setting&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> headerImage.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));<span class="comment">//后缀“.png”</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(suffix))&#123;<span class="comment">//图片后缀为空</span></span><br><span class="line">            model.addAttribute(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;文件格式不正确&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/user/setting&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fileName=CommunityUtil.generateUUID()+suffix;<span class="comment">//新的filename（随机生成+原来后缀）</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath + <span class="string">&quot;/&quot;</span> + fileName);<span class="comment">//上传文件后，该文件的路径(存在本地路径</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//存储文件</span></span><br><span class="line">            headerImage.transferTo(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;上传文件失败&quot;</span>+e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//更新用户头像的url</span></span><br><span class="line">        <span class="comment">//http://localhost:8080/community/user/header/xxx.png静态资源</span></span><br><span class="line">        User user=hostHolder.getUser();</span><br><span class="line">        String headerUrl=domain+contextPath+<span class="string">&quot;/user/header/&quot;</span>+fileName;</span><br><span class="line">        userService.updateHeader(user.getId(),headerUrl);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:index&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>获取头像：</p>
<p>利用responsse向页面输出图片</p>
<p>表明返回类型是图片：response.setContentType(“image&#x2F;后缀”)</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>1.重定向路径写成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return &quot;redirect:index&quot;;</span><br></pre></td></tr></table></figure>

<p>后，浏览器路径实际是：<a target="_blank" rel="noopener" href="http://localhost:8080/community/user/index%EF%BC%8C%E5%9B%A0%E4%B8%BA%E2%80%9C/%E2%80%9D%E6%98%AF%E9%A1%B9%E7%9B%AE%E6%A0%B9%E8%B7%AF%E5%BE%84">http://localhost:8080/community/user/index，因为“/”是项目根路径</a></p>
<p><code>&quot;redirect:/index&quot;</code>表示项目根路径下的index，即目标</p>
<p><code>&quot;redirect:index&quot;</code>带上了类上的@RequestMapping所以实际访问路径错了</p>
<p>2.还有一个bug是上传内存大的图片直接崩溃了，而没有提示信息，可能后面的视频会处理吧</p>
<h2 id="用户登陆状态的判断"><a href="#用户登陆状态的判断" class="headerlink" title="用户登陆状态的判断"></a>用户登陆状态的判断</h2><ul>
<li>防止没登陆也可以直接通过url访问某些功能</li>
<li>即先判断是否登录了</li>
<li>拦截器</li>
</ul>
<img src="../images/image-20240410213641775.png" alt="image-20240410213641775" style="zoom:33%;" />

<ul>
<li><strong><u>只拦截</u>带有某自定义注解的方法</strong></li>
<li>自定义注解：<ul>
<li>@Target自定义的注解作用在什么上</li>
<li>@Retention作用周期</li>
</ul>
</li>
</ul>
<p>反射</p>
<p>Method.getDeclaredAnnotations获取这个方法上所有注解</p>
<p>Method.getAnnotation(Class&lt; T&gt; annotationClass)获取这个类型的注解</p>
<p>步骤：</p>
<p>1.自定义注解类 </p>
<p>2.打开controller，给要拦截的方法加上自定义的注解</p>
<p>3.定义拦截器</p>
<ul>
<li><p><code>HandlerMethod</code>对象封装了对应的Controller和Method对象信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> HostHolder hostHolder;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="keyword">if</span>(handler <span class="keyword">instanceof</span> HandlerMethod)&#123;<span class="comment">//如果拦截到的是方法</span></span><br><span class="line">           HandlerMethod handlerMethod=(HandlerMethod) handler;<span class="comment">//强转成HandlerMethod，为了好获取信息，因为HandlerMethod对象封装了对应的Controller和Method对象信息</span></span><br><span class="line">           <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> handlerMethod.getMethod();</span><br><span class="line">           <span class="type">LoginRequired</span> <span class="variable">loginRequired</span> <span class="operator">=</span> method.getAnnotation(LoginRequired.class);<span class="comment">//获取该类型的注解</span></span><br><span class="line">           <span class="keyword">if</span>(loginRequired!=<span class="literal">null</span>&amp;&amp;hostHolder.getUser()==<span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="comment">//加了xx注解(要被拦截)，取不到(没登陆)</span></span><br><span class="line">               <span class="comment">//没登陆，重定向去登陆</span></span><br><span class="line">               response.sendRedirect(request.getContextPath()+<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;       </span><br></pre></td></tr></table></figure></li>
</ul>
<p>4.去Webmvcconfig里注册拦截器</p>
<h1 id="社区核心功能"><a href="#社区核心功能" class="headerlink" title="社区核心功能"></a>社区核心功能</h1><h2 id="1-过滤敏感词"><a href="#1-过滤敏感词" class="headerlink" title="1.过滤敏感词"></a>1.过滤敏感词</h2><img src="../images/image-20240412163832321.png" alt="image-20240412163832321" style="zoom:33%;" />

<p>前缀树(数据结构) </p>
<ul>
<li><p>空间换时间</p>
</li>
<li><p>利用前缀树检测一个字符串里有没有敏感词</p>
</li>
<li><p>前缀树特点：</p>
<ul>
<li><p>根节点不包含字符</p>
</li>
<li><p>除根结点外的节点只包含一个节点</p>
</li>
<li><p>从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串。</p>
</li>
<li><p>每个节点的所有子节点包含的字符都不相同。</p>
</li>
</ul>
</li>
</ul>
<img src="../images/image-20240412164629627.png" alt="image-20240412164629627" style="zoom:33%;" />

<p>前侧需要三个指针（变量）：前缀树的根，两个指针标记字符串中敏感词的开头和结尾</p>
<img src="../images/image-20240412164942577.png" alt="image-20240412164942577" style="zoom:33%;" />

<p>做记号表示到该字母的字符串是一个敏感词（关键词结束的标志）</p>
<p>处理后的结果存在StringBuilder里</p>
<hr>
<p>补充：</p>
<ol>
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">try(流的开启语句)&#123;&#125;</span><br><span class="line"></span><br><span class="line">catch(Exception e)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>资环会自动关闭，不用手动在finally关闭</p>
<p>2.字节流、字符流、缓冲流：</p>
<p>[字节流和字符流以及缓冲区（简介和了解以及使用）_字节流有缓冲区吗-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43909848/article/details/103200176#:~:text=%E4%B8%80.%E5%AD%97%E8%8A%82%E6%B5%81%E5%9C%A8%E6%93%8D%E4%BD%9C%E6%97%B6%E4%B8%8D%E4%BC%9A%E7%94%A8%E5%88%B0%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%88%E5%86%85%E5%AD%98%EF%BC%89%EF%BC%8C%E6%98%AF%E7%9B%B4%E6%8E%A5%E5%AF%B9%E6%96%87%E4%BB%B6%E6%9C%AC%E8%BA%AB%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%E7%9A%84%E3%80%82,%E8%80%8C%E5%AD%97%E7%AC%A6%E6%B5%81%E5%9C%A8%E6%93%8D%E4%BD%9C%E6%97%B6%E4%BD%BF%E7%94%A8%E4%BA%86%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%8C%E9%80%9A%E8%BF%87%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%8D%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E3%80%82">https://blog.csdn.net/weixin_43909848/article/details/103200176#:~:text=一.字节流在操作时不会用到缓冲区（内存），是直接对文件本身进行操作的。,而字符流在操作时使用了缓冲区，通过缓冲区再操作文件。</a> 二.在硬盘上的所有文件都是以字节形式存在的（图片，声音，视频），而字符值在内存中才会形成。)</p>
<p>E.G.:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span><span class="comment">//在bean构造完自动调用（服务启动之后），只一次</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//类加载器从类路径下读取文件</span></span><br><span class="line">        <span class="keyword">try</span>(InputStream is= <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;sensitive-words.txt&quot;</span>);</span><br><span class="line">            <span class="comment">//从字节流中读取文字不方便，转成字符流，再转成缓冲流</span></span><br><span class="line">            BufferedReader reader=<span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line">        )&#123;&#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            logger.error(<span class="string">&quot;读取敏感词文件失败&quot;</span>+e.getMessage());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>在硬盘上的所有文件都是以字节形式存在的（图片，声音，视频），而字符值在内存中才会形成。</strong><br>简单的说就是在你需要对文件进行操作的时候（比如读写文件，下载，移动各种）用字节流。但是在需要对文件的内容进行操作，读取的时候就要用字符流。</p>
</blockquote>
<ol>
<li></li>
</ol>
<p><code>this.getClass().getClassLoader().getResourceAsStream(&quot;sensitive-words.txt&quot;);</code>读取文件，是字节流</p>
<p><code>new InputStreamReader(is)</code>字节流转成字符流，以操作内容</p>
<p><code>BufferedReader reader=new BufferedReader(new InputStreamReader(is));</code>缓冲区，以提高速度</p>
<p>2.自动finally关闭</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try(</span><br><span class="line">//流开启语句</span><br><span class="line">InputStream is= this.getClass().getClassLoader().getResourceAsStream(&quot;sensitive-words.txt&quot;);</span><br><span class="line">BufferedReader reader=new BufferedReader(new InputStreamReader(is));</span><br><span class="line">        )&#123;&#125;</span><br><span class="line">        catch (Exception e)&#123;</span><br><span class="line">            logger.error(&quot;读取敏感词文件失败&quot;+e.getMessage());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>思路：</p>
<hr>
<h2 id="2-发布帖子"><a href="#2-发布帖子" class="headerlink" title="2.发布帖子"></a>2.发布帖子</h2><img src="../images/image-20240417170518834.png" alt="image-20240417170518834" style="zoom:33%;" />

<ul>
<li>异步请求<ul>
<li>一般是以异步形式有向服务器提交数据，所以<strong>POST</strong></li>
</ul>
</li>
<li>页面内容、路径没有变，但是得到了访问结果</li>
</ul>
<h3 id="ajax使用实例"><a href="#ajax使用实例" class="headerlink" title="ajax使用实例"></a>ajax使用实例</h3><p>controller层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ajax示例</span></span><br><span class="line">    <span class="meta">@RequestMapping(path=&quot;/ajax&quot;,method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">ajax</span><span class="params">(String name,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(age);</span><br><span class="line">        <span class="keyword">return</span> CommunityUtil.getJSONString(<span class="number">0</span>,<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>html</p>
<ul>
<li><p><strong>发送异步请求</strong>：</p>
</li>
<li><pre><code> $.post(
 url,json数据,回调函数
 );
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;发送&quot; onclick=&quot;send();&quot;&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function send()&#123;</span><br><span class="line">            $.post(</span><br><span class="line">                &quot;/community/alpha/ajax&quot;,</span><br><span class="line">                &#123;&quot;name&quot;:&quot;purin&quot;,&quot;age&quot;:&quot;21&quot;&#125;,</span><br><span class="line">                function(data)&#123;</span><br><span class="line">                    console.log(typeof(data));//string</span><br><span class="line">                    console.log(data);</span><br><span class="line">                    data=$.parseJSON(data);//字符串转成对象</span><br><span class="line">                    console.log(typeof(data));//object</span><br><span class="line">                    console.log(data);</span><br><span class="line">                    console.log(data.code);</span><br><span class="line">                    console.log(data.msg);</span><br><span class="line">                    /*data是“0,&quot;ok”“，用户传给服务器的*/</span><br><span class="line">                &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>点击按钮后：页面没有变化，但是能收到服务器发来的数据</p>
<h3 id="发帖子"><a href="#发帖子" class="headerlink" title="发帖子"></a>发帖子</h3><ul>
<li><p>对特殊字符转义：</p>
</li>
<li><pre><code>HtmlUtils.htmlEscape()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">利用js给发布按钮绑定事件，获取元素组件的数据，并利用ajax发送异步请求把数据传给</span><br><span class="line"></span><br><span class="line">controller。</span><br><span class="line"></span><br><span class="line">js:</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">$(function()&#123;</span><br><span class="line">	$(&quot;#publishBtn&quot;).click(publish);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function publish() &#123;</span><br><span class="line">	$(&quot;#publishModal&quot;).modal(&quot;hide&quot;);</span><br><span class="line">	//获取标题和内容</span><br><span class="line">	var title=$(&quot;#recipient-name&quot;).val();/*id选择器*/</span><br><span class="line">	var content=$(&quot;#message-text&quot;).val();</span><br><span class="line">	//发送异步请求</span><br><span class="line">	$.post(</span><br><span class="line">		CONTEXT_PATH+&quot;/discuss/add&quot;,</span><br><span class="line">		&#123;&quot;title&quot;:title,&quot;content&quot;:content&#125;,</span><br><span class="line">		function(data)&#123;</span><br><span class="line">			data= $.parseJSON(data);//字符串转对象</span><br><span class="line">			//获取提示框对应的元素，并设置内容</span><br><span class="line">			$(&quot;#hintBody&quot;).text(data.msg);</span><br><span class="line">			//显示提示框，两秒后提示框自动消失</span><br><span class="line">			$(&quot;#hintModal&quot;).modal(&quot;show&quot;);</span><br><span class="line">			setTimeout(function()&#123;</span><br><span class="line">				$(&quot;#hintModal&quot;).modal(&quot;hide&quot;);</span><br><span class="line">				//如果发布成功，刷新页面(reload)</span><br><span class="line">				if(data.code==0)&#123;</span><br><span class="line">					window.location.reload();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;, 2000);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h2 id="4-事务管理"><a href="#4-事务管理" class="headerlink" title="4.事务管理"></a>4.事务管理</h2><p>事务：要么全执行、要么全不执行</p>
<img src="../images/image-20240418112225866.png" alt="image-20240418112225866" style="zoom:33%;" />

<img src="../images/image-20240418112434148.png" alt="image-20240418112434148" style="zoom:33%;" />

<hr>
<p>第一类丢失更新：</p>
<ul>
<li>某个事务的rollback导致另一个已更新的数据丢失</li>
<li><img src="../images/image-20240418112840199.png" alt="image-20240418112840199" style="zoom:33%;" />
- 事务2提交，事务1回滚，导致事务2的修改丢失</li>
</ul>
<p>第二类丢失更新</p>
<ul>
<li>一个事务的提交导致另一个事务的更新丢失</li>
<li><img src="../images/image-20240418113109221.png" alt="image-20240418113109221" style="zoom:33%;" /></li>
</ul>
<p>脏读</p>
<ul>
<li>读到了另一个事务未提交的数据（一回滚就不一致了</li>
</ul>
<p>不可重复读【一行数据】</p>
<ul>
<li>某事务(时间间隔很短)对<strong>同一个数据</strong>的访问结果不一致</li>
<li><img src="../images/image-20240418113233878.png" alt="image-20240418113233878" style="zoom:33%;" />
- 事务2先后读到的结果不一致</li>
</ul>
<p>幻读【多行数据】</p>
<ul>
<li>某事物对<strong>同一张表</strong>的<strong>查询到的行数不一致</strong></li>
<li><img src="../images/image-20240418113442838.png" alt="image-20240418113442838" style="zoom:33%;" /></li>
</ul>
<hr>
<p>隔离级别：</p>
<img src="../images/image-20240418114400647.png" alt="image-20240418114400647" style="zoom:33%;" />

<p>实现机制：</p>
<h3 id="悲观锁乐观锁："><a href="#悲观锁乐观锁：" class="headerlink" title="悲观锁乐观锁："></a>悲观锁乐观锁：</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mingyueyy/p/13049431.html">悲观锁与乐观锁的实现(详情图解) - 牧小农 - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lixld/article/details/104542570">MySQL 技巧：数据库实现 乐观锁 (版本控制&#x2F;条件过滤)| 悲观锁(for update)-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/52678870">深入理解数据库行锁与表锁 - 知乎 (zhihu.com)</a></p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2024/03/25/py-note/"
      title="py note"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        py note
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2024/03/20/springboot/"
      title="springboot"
     >

    <p class="title-text">
      
        springboot
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>




    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2024 purin<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
